<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout :: head('Books')"></head>
<body>
    <div th:replace="layout :: nav"></div>
    <div class="container mt-4">
        <div th:replace="layout :: alerts"></div>
        
        <div class="d-flex justify-content-between align-items-center">
            <h2>Books Catalog</h2>
            <a th:href="@{/books/add}" class="btn btn-primary" sec:authorize="hasRole('LIBRARIAN')">Add New Book</a>
        </div>
        
        <div class="search-box">
            <form th:action="@{/books}" method="get" class="d-flex">
                <input type="text" name="search" class="form-control me-2" placeholder="Search by title or author">
                <button type="submit" class="btn btn-outline-primary">Search</button>
            </form>
        </div>
        
        <div class="book-table">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Author</th>
                        <th>ISBN</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="book : ${books}">
                        <td th:text="${book.title}"></td>
                        <td th:text="${book.author}"></td>
                        <td th:text="${book.isbn}"></td>
                        <td>
                            <span th:if="${book.available}" class="badge bg-success">Available</span>
                            <span th:unless="${book.available}" class="badge bg-warning">Issued</span>
                        </td>
                        <td class="action-buttons">
                            <div sec:authorize="hasRole('LIBRARIAN')">
                                <a th:href="@{/books/edit/{id}(id=${book.id})}" class="btn btn-sm btn-warning">Edit</a>
                                <a th:href="@{/books/delete/{id}(id=${book.id})}" class="btn btn-sm btn-danger"
                                   onclick="return confirm('Are you sure you want to delete this book?')">Delete</a>
                            </div>
                            <div sec:authorize="hasRole('STUDENT')">
                                <a th:if="${book.available}" th:href="@{/books/issue/{id}(id=${book.id})}" 
                                   class="btn btn-sm btn-success">Issue</a>
                                <a th:unless="${book.available}" th:href="@{/books/return/{id}(id=${book.id})}" 
                                   class="btn btn-sm btn-warning">Return</a>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(books)}">
                        <td colspan="5" class="text-center">No books found</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <div th:replace="layout :: footer"></div>
</body>
</html>