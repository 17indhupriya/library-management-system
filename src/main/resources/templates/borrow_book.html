<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Borrow Book')}"></head>
<body>
    <div th:replace="~{layout :: nav}"></div>
    <main style="padding: 2rem; min-height: calc(100vh - 200px); display: flex; align-items: center; justify-content: center;">
        <div class="container-fluid" style="max-width: 600px;">
            <div th:replace="~{layout :: alerts}"></div>
            
            <!-- Book Info Card -->
            <div class="glass-card" style="margin-bottom: 2rem; text-align: center;">
                <div style="padding: 2rem;">
                    <i class="bi bi-book-half" style="font-size: 3rem; color: var(--primary-blue); display: block; margin-bottom: 1rem;"></i>
                    <h2 style="font-size: 1.8rem; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--primary-blue), var(--secondary-lavender)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" 
                        th:text="${book.title}">Book Title</h2>
                    <p style="color: var(--text-light); font-size: 1.1rem; margin-bottom: 0.3rem;" th:text="${book.author}">Author</p>
                    <small style="color: var(--text-light);">ISBN: <span th:text="${book.isbn}"></span></small>
                </div>
            </div>
            
            <!-- Borrow Form -->
            <div class="glass-card">
                <div style="padding: 2rem;">
                    <h3 style="margin-bottom: 2rem;">
                        <i class="bi bi-calendar-check"></i> Set Borrow Duration
                    </h3>
                    
                    <form th:action="@{/books/borrow/{id}(id=${book.id})}" method="post" class="needs-validation" novalidate>
                        <div class="form-group" style="margin-bottom: 1.5rem;">
                            <label for="issueDate" style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                                <i class="bi bi-calendar-event"></i> Issue Date
                            </label>
                            <input type="date" class="form-control" id="issueDate" name="issueDate" required
                                   th:min="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}"
                                   th:value="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}"
                                   style="padding: 0.75rem 1rem; border: none; background: rgba(255,255,255,0.5); border-radius: 12px; font-size: 1rem;">
                            <div class="invalid-feedback">
                                Please select an issue date.
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 2rem;">
                            <label for="returnDate" style="font-weight: 600; margin-bottom: 0.5rem; display: block;">
                                <i class="bi bi-calendar-check"></i> Return Date (14 days default)
                            </label>
                            <input type="date" class="form-control" id="returnDate" name="returnDate" required
                                   th:min="${#temporals.format(#temporals.createNow().plusDays(1), 'yyyy-MM-dd')}"
                                   th:value="${#temporals.format(#temporals.createNow().plusDays(14), 'yyyy-MM-dd')}"
                                   style="padding: 0.75rem 1rem; border: none; background: rgba(255,255,255,0.5); border-radius: 12px; font-size: 1rem;">
                            <div class="invalid-feedback">
                                Please select a return date (at least one day after the issue date).
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem;">
                            <button type="submit" class="btn btn-success" style="flex: 1;">
                                <i class="bi bi-download"></i> Confirm Borrow
                            </button>
                            <a th:href="@{/books}" class="btn btn-primary" style="flex: 1;">
                                <i class="bi bi-arrow-left"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
    
    <div th:replace="~{layout :: footer}"></div>
    
    <script>
    // JavaScript for form validation
    (function() {
        'use strict';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch all forms that need validation
            var forms = document.querySelectorAll('.needs-validation');
            
            // Add validation on submit
            Array.prototype.slice.call(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
            
            // Add custom validation for return date
            var issueDateInput = document.getElementById('issueDate');
            var returnDateInput = document.getElementById('returnDate');
            
            issueDateInput.addEventListener('change', function() {
                // Update return date min value when issue date changes
                var issueDate = new Date(this.value);
                issueDate.setDate(issueDate.getDate() + 1);
                returnDateInput.min = issueDate.toISOString().split('T')[0];
                
                // If return date is now invalid, clear it
                if (new Date(returnDateInput.value) <= new Date(this.value)) {
                    returnDateInput.value = '';
                }
            });
        });
    })();
    </script>
</body>
</html>